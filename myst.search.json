{"version":"1","records":[{"hierarchy":{"lvl1":"Hunt 1"},"type":"lvl1","url":"/docs/hunts/hunt-1","position":0},{"hierarchy":{"lvl1":"Hunt 1"},"content":"Threat Hunting takes time... just like this page!","type":"content","url":"/docs/hunts/hunt-1","position":1},{"hierarchy":{"lvl1":"Hunt 1","lvl2":"Just some random tests"},"type":"lvl2","url":"/docs/hunts/hunt-1#just-some-random-tests","position":2},{"hierarchy":{"lvl1":"Hunt 1","lvl2":"Just some random tests"},"content":"graph TD\n    A[Start] --> B{Is it working?}\n    B -- Yes --> C[Great!]\n    B -- No --> D[Fix it]\n    D --> Bdef greet(name):\n    print(\"Simple test\")\n    print(f\"Hello, {name}!\")\n    print(\"Welcome!\")\n\nWarning\n\nThis Page is still under construction... Read it with caution!","type":"content","url":"/docs/hunts/hunt-1#just-some-random-tests","position":3},{"hierarchy":{"lvl1":"Threat Hunting Book"},"type":"lvl1","url":"/","position":0},{"hierarchy":{"lvl1":"Threat Hunting Book"},"content":"Warning\n\nThis Page is still under construction... Read it with caution!","type":"content","url":"/","position":1},{"hierarchy":{"lvl1":"Threat Hunting Book","lvl2":"My work"},"type":"lvl2","url":"/#my-work","position":2},{"hierarchy":{"lvl1":"Threat Hunting Book","lvl2":"My work"},"content":"Not hunting bad guys here, but their tools and strategies. What is important is to understand the Threat to better Hunt It Down before new victims come up. Over the years of working as a Cybersecurity Engineer, I’ve seen some campaigns, alerts, malwares, research papers, adversary patterns, ... All this gave me the idea of summarizing my knowledge and experience into a Notebook. And here it is, my very own Threat Hunting Book!\n\nPersonal Note: Threat Hunting (or Thrunting) is one of those activities in the technical field of Cybersecurity expertise that requires more consideration in my opinion. It’s often viewed as “part of” some other stuff, or considered as “best effort” only. My goal is not to “create” something dead impressive, but rather bring to the community what I’ve learned during my Thrunting trip, and just hope I can make it useful.","type":"content","url":"/#my-work","position":3},{"hierarchy":{"lvl1":"Threat Hunting Book","lvl2":"What is this Notebook for?"},"type":"lvl2","url":"/#what-is-this-notebook-for","position":4},{"hierarchy":{"lvl1":"Threat Hunting Book","lvl2":"What is this Notebook for?"},"content":"Present my previous, current and future work in the field of Threat Hunting & Analysis.\n\nContribute as much as possible to the community.\n\nProvide lessons learned and small courses that can help the learning.\n\nShare presentations material I’ve made during my conferences or guest talks.\n\nStore Proof of Concepts scripts or adversary simulation attack patterns and detection / signature rules (YARA, Sigma, EDR/SIEM Queries)\n\nFeel free to suggest anything using Pull Requests or Issues on my personal \n\nGithub Repo for these Pages.","type":"content","url":"/#what-is-this-notebook-for","position":5},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)"},"type":"lvl1","url":"/docs/malware-analysis/ma-windows-binary-part1","position":0},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)"},"content":"Warning\n\nThis Page is still under construction... Read it with caution!","type":"content","url":"/docs/malware-analysis/ma-windows-binary-part1","position":1},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl2":"Description"},"type":"lvl2","url":"/docs/malware-analysis/ma-windows-binary-part1#description","position":2},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl2":"Description"},"content":"This is the material presented in HTB France’s meetup about Malware Analysis.","type":"content","url":"/docs/malware-analysis/ma-windows-binary-part1#description","position":3},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl2":"Topics covered"},"type":"lvl2","url":"/docs/malware-analysis/ma-windows-binary-part1#topics-covered","position":4},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl2":"Topics covered"},"content":"Windows Executables lifecycle\n\nWhy Windows: Introduction to LOLBAS\n\nIntroduction to Windows API\n\nMalware Families / Variants\n\nThe full content of the presentation will come soon!","type":"content","url":"/docs/malware-analysis/ma-windows-binary-part1#topics-covered","position":5},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl2":"Payload Analysis Demo 1: Mistake or Feature?"},"type":"lvl2","url":"/docs/malware-analysis/ma-windows-binary-part1#payload-analysis-demo-1-mistake-or-feature","position":6},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl2":"Payload Analysis Demo 1: Mistake or Feature?"},"content":"Very basic Malware Analysis & Triage on a delivered payload made for this demo.\n\nWarning\n\nDemo Payloads are NOT available yet!","type":"content","url":"/docs/malware-analysis/ma-windows-binary-part1#payload-analysis-demo-1-mistake-or-feature","position":7},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl3":"Static Analysis","lvl2":"Payload Analysis Demo 1: Mistake or Feature?"},"type":"lvl3","url":"/docs/malware-analysis/ma-windows-binary-part1#static-analysis","position":8},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl3":"Static Analysis","lvl2":"Payload Analysis Demo 1: Mistake or Feature?"},"content":"PEstudio\n\nFirst look at PEstudio data:\n\nBinary seems to be compiled with Microsoft Visual Linker from C++\n\nSize is 243200 bytes\n\nEntropy is 6.184 which could mean that it is not packed, nor obfuscated / encrypted\n\nSections:\n\nraw-size and virtual-size are close to the same value: we can confirm this Binary is not packed\n\nSize is “small”, maybe it is part of a stager or is a dropper?\n\nModule imports:\n\nWe can’t conclude anything from the imported libraries, but we are able to gather some new information we can use to anticipate its behavior during the dynamic analysis, and since the payload may not be obfuscated and is small-sized, static data should be pretty interesting:\n\nGetCurrentThreadId, GetCurrentThread andSetThreadStackGuarantee: can imply Threads Manipulation\n\nGetEnvironmentVariableW: getting environment variables of the system can imply Host Discovery\n\nWriteFile, FindNextFileW, FindFirstFileW and NtWriteFile: writing and searching for files can imply Files Dropping and Files / Directories Discovery\n\nWe can’t find any imports of functions to download resources online, which can imply that this payload might NOT be a dropper or a stager. But of course, this has to be confirmed.\n\nDetect It Easy\n\nWe can now inspect the binary further by looking at the strings, maybe we will find some interesting things since the Binary is not obfuscated\n\nRust compiler! I can already tell you we are cooked for the decompiling part.\n\nWe have found an interesting long string called search_results_.txt, which we should expect to see in the decompiled code and during execution.\n\nQuick view of Ghidra Decompiler\n\nRust is... something when coming to decompilation. We can always decompile the Binary to Assembly, but what is magic with Ghidra is that it can produce Pseudo C code to help us performing code analysis. Here... Ghidra is clearly not made for Rust.\n\nLet’s skip that for now. But here is a screenshot of me searching through the strings to find the one we have identified earlier. This Assembly experience wasn’t that interesting to explore so let’s skip that for now. We might need to do an entire course just for the Rust compiler. But don’t worry, in part 2 we’ll see more about decompiling Windows Binaries and do actual static code analysis!","type":"content","url":"/docs/malware-analysis/ma-windows-binary-part1#static-analysis","position":9},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl3":"Dynamic Analysis","lvl2":"Payload Analysis Demo 1: Mistake or Feature?"},"type":"lvl3","url":"/docs/malware-analysis/ma-windows-binary-part1#dynamic-analysis","position":10},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl3":"Dynamic Analysis","lvl2":"Payload Analysis Demo 1: Mistake or Feature?"},"content":"Okay let’s take 2 seconds to think about what we want to see / confirm:\n\nNo external resources should be accessed (no need for wireshark or INetSim - will be covered in part 2)\n\nA file should be written at some point during execution\n\nSomething with searching for files should be there\n\nMulti-threading or multi-processing could also be a thing\n\nSomething with environment variables: maybe for persistence?\n\nAnd finally: what is this binary doing exacty?\n\nProcmon filtered on the executable name\n\nAt the very beginning we can’t really see something special, except the creation of new Thread, the use of environment variables and some noise.\n\nThen when scrolling in the Procmon logs we find what looks like Files / Directories Enumeration activity. Basically, the binary is recursively searching through many folders and look for everything in them, starting at AppData folder. Earlier we saw a log showing us that the environment variables have been requested, it might be to get the full path of the AppData folder.\n\nAnd here is the file creation event we were expecting, let’s have a look at its content!\n\nThis .txt file seems to record information from the files the binary reads during the File / Dir Enumeration and then add it to this file. The full logic behind it is a blackbox, but now we know that this binary seems to act as the first stage of a stealer, trying to gather as much secret data as possible from the system, and stores it somewhere the user would not think of. Thus, makes it ready for Data Exfiltration.\n\nProcexp\n\nWe can only see that the process for the binary is started and then stops once it is finished. Also, we can’t confirm multi-processing is a thing, also that there is any external connection.\n\nNo traces of Other processes or external connections.\n\nAutoruns: No persistence can be seen\n\nNo traces of Autoruns.","type":"content","url":"/docs/malware-analysis/ma-windows-binary-part1#dynamic-analysis","position":11},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl3":"Automated Static Analysis","lvl2":"Payload Analysis Demo 1: Mistake or Feature?"},"type":"lvl3","url":"/docs/malware-analysis/ma-windows-binary-part1#automated-static-analysis","position":12},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl3":"Automated Static Analysis","lvl2":"Payload Analysis Demo 1: Mistake or Feature?"},"content":"Now we run Capa and see if we can confirm our hypothesis!\n\nThe only thing we didn’t catch with this basic Triage was a XOR operation (see CAPA results) which does not seem to have a big impact during execution.","type":"content","url":"/docs/malware-analysis/ma-windows-binary-part1#automated-static-analysis","position":13},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl3":"Demo 1: Conclusion","lvl2":"Payload Analysis Demo 1: Mistake or Feature?"},"type":"lvl3","url":"/docs/malware-analysis/ma-windows-binary-part1#demo-1-conclusion","position":14},{"hierarchy":{"lvl1":"Malware Analysis 101: Introduction to Windows Binary (Stage 1)","lvl3":"Demo 1: Conclusion","lvl2":"Payload Analysis Demo 1: Mistake or Feature?"},"content":"Verdict: Benign (not malicious)\n\nWhy? This binary is not exfiltrating information, only doing offline recon on files and saving it in a “search file” in the Temp folder. Is it a mistake or a feature?","type":"content","url":"/docs/malware-analysis/ma-windows-binary-part1#demo-1-conclusion","position":15},{"hierarchy":{"lvl1":"About Me"},"type":"lvl1","url":"/docs/whoami/aboutme","position":0},{"hierarchy":{"lvl1":"About Me"},"content":"This will come soon!\n\nWarning\n\nThis Page is still under construction... Read it with caution!","type":"content","url":"/docs/whoami/aboutme","position":1},{"hierarchy":{"lvl1":"Contact"},"type":"lvl1","url":"/docs/whoami/contact","position":0},{"hierarchy":{"lvl1":"Contact"},"content":"This will come soon!\n\nWarning\n\nThis Page is still under construction... Read it with caution!","type":"content","url":"/docs/whoami/contact","position":1}]}